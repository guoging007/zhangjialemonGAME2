# 產生支援手機觸控拖曳送出版本的 HTML 程式碼
html_touch_drag_code = """
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>張家檸檬傳說 - 手機拖曳版</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100%;
      font-family: "Microsoft YaHei", sans-serif;
      background: url('背景1.png') center/cover no-repeat;
      overflow: hidden;
    }
    body::before {
      content: "";
      position: absolute;
      inset: 0;
      backdrop-filter: blur(8px);
      z-index: 0;
    }
    .game-area {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      color: #fff;
      text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
      font-weight: bold;
    }
    #lemon {
      width: 120px;
      cursor: pointer;
    }
    .draggable {
      width: 80px;
      position: absolute;
      touch-action: none;
      z-index: 5;
    }
    #drinkImage {
      top: 50%;
      right: 40px;
      transform: translateY(-50%);
    }
    #sugarImage {
      top: 50%;
      left: 40px;
      transform: translateY(-50%);
    }
    #drinkCount, #sugarCount {
      position: absolute;
      font-size: 20px;
      font-weight: bold;
      color: white;
      z-index: 5;
      text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    }
    #drinkCount {
      top: calc(50% + 60px);
      right: 45px;
    }
    #sugarCount {
      top: calc(50% + 60px);
      left: 45px;
    }
    #customerArea {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
    }
    .customer {
      display: flex;
      align-items: center;
    }
    .customer img {
      width: 30vw;
      max-height: 90vh;
    }
    .request {
      margin-left: 16px;
      background: #fff3cd;
      border: 2px solid #e0b800;
      border-radius: 10px;
      padding: 10px 16px;
      font-size: 22px;
      font-weight: bold;
      white-space: nowrap;
      color: #000;
    }
    .angry {
      background-color: #f44336 !important;
      color: white !important;
      text-shadow: none;
    }
  </style>
</head>
<body>
  <div class="game-area">
    <h1>🍋 張家檸檬傳說</h1>
    <p>點檸檬10下 → 產出飲料</p>
    <img id="lemon" src="檸檬圖片1.png" alt="檸檬" />
    <p>點擊次數：<span id="clickCount">0</span></p>
  </div>
  <img id="drinkImage" class="draggable" src="檸檬飲料圖片1.png" alt="飲料" />
  <div id="drinkCount">x 0</div>
  <img id="sugarImage" class="draggable" src="白糖1.png" alt="白糖" />
  <div id="sugarCount">∞</div>
  <div id="customerArea"></div>

  <script>
    let clickCount = 0, drinkStock = 0;
    let customerExists = false, startTime = Date.now(), isFirstCustomer = true;
    let customerCount = 0;

    const lemon = document.getElementById("lemon");
    const drinkImage = document.getElementById("drinkImage");
    const sugarImage = document.getElementById("sugarImage");
    const drinkCountSpan = document.getElementById("drinkCount");
    const sugarCountSpan = document.getElementById("sugarCount");
    const clickCountSpan = document.getElementById("clickCount");
    const customerArea = document.getElementById("customerArea");

    lemon.onclick = () => {
      clickCount++;
      clickCountSpan.textContent = clickCount;
      if (clickCount >= 10) {
        clickCount = 0;
        drinkStock++;
        updateUI();
      }
    };

    function updateUI() {
      drinkCountSpan.textContent = "x " + drinkStock;
      sugarCountSpan.textContent = "∞";
    }

    function makeDraggable(item, type) {
      let offsetX = 0, offsetY = 0;
      item.addEventListener("touchstart", e => {
        const touch = e.touches[0];
        offsetX = touch.clientX - item.offsetLeft;
        offsetY = touch.clientY - item.offsetTop;
      });
      item.addEventListener("touchmove", e => {
        e.preventDefault();
        const touch = e.touches[0];
        item.style.left = `${touch.clientX - offsetX}px`;
        item.style.top = `${touch.clientY - offsetY}px`;
      });
      item.addEventListener("touchend", () => {
        const customer = document.querySelector(".customer img");
        if (!customer) return;
        const rect1 = item.getBoundingClientRect();
        const rect2 = customer.getBoundingClientRect();
        if (rect1.right > rect2.left && rect1.left < rect2.right &&
            rect1.bottom > rect2.top && rect1.top < rect2.bottom) {
          tryServe(type);
        }
        item.style.top = type === "drink" ? "50%" : "50%";
        item.style.left = type === "drink" ? "" : "40px";
        item.style.right = type === "drink" ? "40px" : "";
      });
    }

    makeDraggable(drinkImage, "drink");
    makeDraggable(sugarImage, "sugar");

    function tryServe(type) {
      const customer = document.querySelector(".customer");
      if (!customer || !customerExists) return;

      let needDrink = +customer.dataset.needDrink || 0;
      let needSugar = +customer.dataset.needSugar || 0;
      let servedDrink = +customer.dataset.servedDrink || 0;
      let servedSugar = +customer.dataset.servedSugar || 0;

      if (type === "drink" && servedDrink < needDrink && drinkStock > 0) {
        servedDrink++; drinkStock--;
      }
      if (type === "sugar" && servedSugar < needSugar) {
        servedSugar++;
      }

      customer.dataset.servedDrink = servedDrink;
      customer.dataset.servedSugar = servedSugar;
      updateUI();

      if (servedDrink >= needDrink && servedSugar >= needSugar) {
        customer.querySelector(".request").textContent = "感謝光臨！";
        setTimeout(() => removeCustomer(customer), 1000);
      }
    }

    function spawnCustomer() {
      if (customerExists) return;
      customerExists = true; customerCount++;
      const customer = document.createElement("div");
      customer.className = "customer";
      const isAfter2Min = (Date.now() - startTime) > 120000;
      const isCustomer3 = customerCount % (Math.floor(Math.random() * 6) + 15) === 0;
      const useCustomer2 = !isCustomer3 && isAfter2Min && Math.random() < 0.5;
      const imageName = isCustomer3 ? "客人3.png" : useCustomer2 ? "客人2.png" : "客人1.png";
      const needDrink = isCustomer3 ? Math.floor(Math.random() * 2) + 1 : Math.floor(Math.random() * 5) + 1;
      const needSugar = isCustomer3 ? 30 : Math.floor(Math.random() * 4);
      const waitTime = isCustomer3 ? 10000 + Math.random()*2000 :
                        useCustomer2 ? 9000 + Math.random()*3000 : 12000 + Math.random()*5000;

      customer.dataset.needDrink = needDrink;
      customer.dataset.needSugar = needSugar;
      customer.dataset.servedDrink = 0;
      customer.dataset.servedSugar = 0;
      customer.dataset.type = isCustomer3 ? "3" : useCustomer2 ? "2" : "1";
      customer.innerHTML = `<img src="${imageName}"><div class="request">我要 ${needDrink} 杯🍋 ${needSugar > 0 ? "+ " + needSugar + " 糖" : ""}</div>`;
      customerArea.appendChild(customer);

      customer.timeout = setTimeout(() => {
        if (+customer.dataset.servedDrink < +customer.dataset.needDrink ||
            +customer.dataset.servedSugar < +customer.dataset.needSugar) {
          customer.querySelector(".request").textContent = "生氣離開了！";
          customer.querySelector(".request").classList.add("angry");
          if (customer.dataset.type === "2") {
            drinkStock = Math.floor(drinkStock * 0.25);
          }
          setTimeout(() => removeCustomer(customer), 1500);
        }
      }, isFirstCustomer ? 30000 : waitTime);
      isFirstCustomer = false;
    }

    function removeCustomer(customer) {
      clearTimeout(customer.timeout);
      customer.remove();
      customerExists = false;
      updateUI();
      setTimeout(spawnCustomer, 3000 + Math.random() * 4000);
    }

    spawnCustomer();
  </script>
</body>
</html>
"""

# 輸出 HTML 檔案
file_path = "/mnt/data/index_touch_drag_mobile.html"
with open(file_path, "w", encoding="utf-8") as f:
    f.write(html_touch_drag_code)

file_path
